# TODO（滚动迭代清单）

> 说明：以 MVP 本地可用为第一目标；每次新增需求先补到 `PRD.md`，再拆到这里。

## P0 · MVP（本地开发）
- [x] 输出/收敛本地开发文档（`DEV.md`）
- [x] 新建 Vue3（Vite）前端项目目录（`web/`）
- [x] 打通数据读取：Vite dev 下通过 `/api/news/*.json` 读取 `NewsReport/data`
- [x] 首页 MVP：日期选择 + 搜索 + 条目列表渲染（先不做重设计）
- [x] 生成市场指标数据：上证指数 + 黄金写入 `NewsReport/data/*`（meta.market）
- [x] 前端展示市场指标卡：上证指数 + 黄金（元/克，先简单展示，后续再做视觉设计）
- [ ] 本地开发脚本：一键生成今日数据 + 启动前端（可先用两个命令）
- [x] 主列表“展示保底”：新内容不足时从补读候选补齐（避免只剩 1 条）
- [x] 源健康度熔断：连续失败自动暂停 N 天（防止坏源拖慢/污染）

## P1 · 自动化（先不做部署，先把流水线跑通）
- [ ] 增加“每日 09:00（Asia/Shanghai）运行”的 CI 方案草案（GitHub Actions/其他）
- [x] 失败可观测：输出失败源、状态码、content-type 与响应前 200 字节（便于定位）

## P2 · 源多样性与质量治理
- [x] 收敛“选源入口”：`my/sources.checklist.md`（勾选） → `sync_sources.py`（生成）→ `my/sources.md`
- [ ] 增加“栏目配比/上限”配置项（技术/经济/产品/其他）
- [ ] 重复治理：跨源转载/同题不同链接的近似去重（规则可配置）
- [ ] 源健康度：连续失败的源临时熔断（带冷却时间）

## P3 · Vue3 站点体验（等你确认设计方向后再做）
- [ ] 视觉与交互重设计（使用 `$frontend-design`，先出方向再开工）
- [ ] 收藏/稍后读、热词/趋势、分享/复制 Markdown
- [ ] 源管理可视化：在站内编辑并落盘到 `my/sources.checklist.md`（再同步生成 `my/sources.md`）

## P1.5 · Lab Chat（静态站 + Node 代理）
- [x] Chat 连通性页：支持图片输入与预览（`web/src/views/LabChatView.vue`）
- [x] 零依赖 Node 代理：转发 + CORS + 注入 Key + 子路径剥前缀（`tools/lab-openai-proxy.mjs`）
- [ ] 生产形态确定：同域路径反代（推荐） vs 独立域名 API（跨域）
- [ ] 生产安全：代理侧强制注入 Key（`LAB_OPENAI_FORCE_API_KEY=1`），前端不再提供 Key 输入（避免误泄露）
- [ ] 生产安全：访问控制（至少选一项：站点鉴权 / IP 白名单 / 网关鉴权 / Zero Trust）
- [ ] 生产安全：限流与审计（避免代理被刷爆导致 Key 被盗刷）
- [ ] 生产健壮性：请求体大小限制（图片 base64 体积大）与超时设置（上游慢/卡）
- [ ] 生产观测：代理日志（status、耗时、上游错误）+ 前端错误提示收敛

## P2.5 · 头条/精选（从规则升级为 AI，可回退）
- [ ] 明确目标：AI 负责“挑选”还是“挑选 + 改写标题/摘要”，以及预算上限（tokens/天）
- [ ] 设计数据契约：输入候选条目（去重后 top N）→ 输出结构化 JSON（lead/top 的索引 + 理由 + 可选 title_zh/summary）
- [ ] 实现 AI 模式（环境变量注入 key，默认不开启）：失败/无 key 时回退现有 `rss-editor-picks` 规则
- [ ] 成本控制：仅对候选做 AI；缓存；必要时分两步（先选，再对入选做摘要）
- [ ] 安全/质量：对 Prompt 注入做防护（只允许从候选中选，不允许编造链接/标题）
